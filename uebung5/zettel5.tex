\documentclass{article}
\usepackage[a4paper, margin=0.8in]{geometry}
\usepackage[utf8]{inputenc}                     % format
\usepackage[english]{babel}                     % language

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}
\usepackage{blindtext}
\usepackage{minted}
% CUSTOM PACKAGES
\usepackage{mathtools}
\usepackage{array}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{hyperref}
\PassOptionsToPackage{hyphens}{url} % linebreaks in URLs

\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcounter{colnum}
\newcommand\colnumber{\stepcounter{colnum}\arabic{colnum}}
\renewcommand{\UrlFont}{\scriptsize}
\usepackage{graphicx}
\usepackage{listings}
\renewcommand{\arraystretch}{1.5}

\title{Datenbanken: Übungsblatt 5}
\author{Florian Rauls, \textbf{Christian Heusel}, Philipp Göldner}
\date{}


\begin{document}

    \vspace*{-5em}
    {\let\newpage\relax\maketitle}

    \begin{center}
        \begin{tabular}{*4{|c}||P{1.5cm}|}
            \hline
            Aufgabe \colnumber{} & Aufgabe \colnumber{} & Aufgabe \colnumber{} & Aufgabe \colnumber{} & $\sum$ \\[5pt]
            \hline
             & & & & \\[5pt]
            \hline
        \end{tabular}
    \end{center}

    \section*{Aufgabe 1}
    \emph{Bitte um Anmerkungen hinsichtlich Formatierung der Anfragen!}
    \begin{enumerate}
        \item
            \begin{minted}{SQL}
SELECT
    a.name
FROM
    ARTIST a, COUNTRY c
WHERE
    c.name='Germany'
    and begin_year > 1950
    and begin_year < 1970
    -- Exclude the bands
    and a.type = 'Group'
    and c.id = a.origin
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT DISTINCT
    c.city
FROM
    ARTIST a, Concert c
WHERE
    a.id = c.artist
    and a.name = 'Rammstein'
    and c.name = 'Winter 2001 Tour'
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT
    a0.name, (a.end_year-a.begin_year) AS Dauer
FROM
    ARTIST_RELATION a
    INNER JOIN ARTIST a1 ON a.artist1 = a1.id
        INNER JOIN ARTIST a0 ON a.artist0 = a0.id
WHERE
    a.type = 'married'
           and a1.name = 'Morgan, Lorrie'
or a0.name = 'Morgan, Lorrie'
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT
    r0.name, r0.year
FROM
    RELEASE r0
    LEFT OUTER JOIN RELEASE r1
        ON r0.format = r1.format AND r0.year > r1.year
    WHERE
        r1.year IS NULL
        AND r0.year IS NOT NULL
        AND r0.format = 'Cassette'
            \end{minted}
\pagebreak
        \item
            \begin{minted}{SQL}
SELECT
    a1.name, a1.begin_year AS Geburtsjahr
FROM
    ARTIST_RELATION a
    INNER JOIN ARTIST a1 ON a.artist1 = a1.id
        INNER JOIN ARTIST a0 ON a.artist0 = a0.id
WHERE
    a.type = 'parent'
    and a0.name = 'Smith, Will'
ORDER BY
    a1.begin_year ASC
            \end{minted}

    \end{enumerate}
    \section*{Aufgabe 2}
    \begin{enumerate}
        \item
            \begin{minted}{SQL}
SELECT DISTINCT
    t.name
FROM
    TRACK t
    INNER JOIN RELEASE r ON t.tracklist = r.tracklist
WHERE
    t.name ILIKE '%what is%'
    AND r.format = 'CD'
    AND r.year = 2011
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT
    a1.name, char_length(a1.name)
FROM
    ARTIST a1
    LEFT OUTER JOIN
        artist a2
    ON
        char_length(a2.name) > char_length(a1.name)
WHERE
    a2.name is NULL
    AND a1.type = 'Group'
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT
    substring(a.name from '\,\s(.*)') AS Vorname
FROM
    ARTIST a
WHERE
    a.begin_year = 1998
    AND a.type = 'Person'
    AND substring(a.name from '\,\s(.*)') is not NULL
            \end{minted}
    \end{enumerate}

\section*{Aufgabe 3}
    \begin{enumerate}
        \item
            \begin{minted}{SQL}
SELECT
    a.name
FROM
    ARTIST a
WHERE
    a.begin_year = 1990
    AND a.type = 'Person'
    AND exists(
        SELECT *
        FROM ARTIST b
        WHERE a.name = b.name AND b.type = 'Group'
    )
            \end{minted}
        \item
            \begin{minted}{SQL}
SELECT DISTINCT
    s.name
FROM
    SONGS s JOIN CONCERT c ON s.setlist = c.setlist
WHERE
    c.artist = (SELECT a.id FROM ARTIST a WHERE a.name = 'AC/DC')
    AND NOT EXISTS(
        SELECT *
        FROM
            TRACK t JOIN RELEASE r ON r.tracklist = t.tracklist
            JOIN ARTIST_CREDIT cred on cred.tracklist = t.tracklist
        WHERE
            cred.artist = (SELECT a.id FROM ARTIST a WHERE a.name = 'AC/DC')
            AND s.name = t.name
    )
            \end{minted}
    \end{enumerate}

\section*{Aufgabe 4}
    \begin{enumerate}
        \item
            \begin{minted}{SQL}
            \end{minted}
        \item
            \begin{minted}{SQL}
            \end{minted}
        \item
            \begin{minted}{SQL}
            \end{minted}
        \item
            \begin{minted}{SQL}
            \end{minted}
        \item
            \begin{minted}{SQL}
            \end{minted}
    \end{enumerate}
\end{document}
